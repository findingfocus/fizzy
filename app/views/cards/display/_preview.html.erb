<% cache [ card ] do %>
  <%= card_article_tag card, class: "card" do %>
    <header class="card__header flex align-center gap min-width">
      <span class="card__collection txt-uppercase overflow-ellipsis txt-reversed"><%= card.collection.name %></span>
      <%= render "cards/display/preview/tags", card: card %>
    </header>

    <div class="card__body flex gap full-width flex-item-grow">
      <h1 class="card__title">
        <span class="card__title-link overflow-line-clamp"><%= card.title %></span>
      </h1>

      <%= link_to collection_card_path(card.collection, card), class: "card__link" do %>
        <span class="for-screen-reader"><%= card.title %></span>
      <% end %>

      <%= render "cards/stagings/stages", card: card if card.doing? %>
    </div>

    <footer class="card__footer">
      <%= render "cards/display/preview/meta", card: card %>
    </footer>

    <%= render "cards/display/common/background", card: card %>

    <% unless card.closed? %>
      <% if card.doing? %>
        <div class="card__badge card__badge--reconsider-soon">
          <%= local_datetime_tag(card.auto_reconsider_at, style: :daysuntil) -%>
        </div>
      <% else %>
        <div class="card__badge card__badge--closing-soon">
          <%= local_datetime_tag(card.auto_close_at, style: :daysuntil) -%>
        </div>
      <% end %>
    <% end %>

  <% end %>
<% end %>
